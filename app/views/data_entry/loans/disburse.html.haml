%h1 Disbursals
- if not @errors.blank?
  .error
    %ul
    - @errors.each do |e|
      - e.values.each do |v|
        %li
          == Loan #{e.resource.id}: #{v}
- loans_to_disburse = @loans
- if loans_to_disburse.size > 0
  = form_for(@loan, :action => url(:enter_loans, :action => "disburse")) do
    %table.narrow.form{ :width => '100%'}
      %thead
        %tr{:style => "font-size: 0.85em;"}
          %th
            id
          %th
            Client Name
          %th
            Details
          %th
            Scheduled Disbursal Date
          %th
            Disbursal Date
          %th
            Status
          %th
            Disbursed?
          %th
            Disbursed By
      - loans_to_disburse.each do |loan|
        %tr{:class => cycle('odd','')}
          %td
            = loan.id
          %td
            = link_to loan.client.name, resource(loan.client)
          %td
            = link_to loan.description, url(:quick_link, "loans", loan.id)
          %td
            = loan.scheduled_disbursal_date
          %td
            = date_select("loans[#{loan.id}][disbursal_date]")
          %td
            - late =  @date - loan.scheduled_disbursal_date
            - if late > 0
              == #{late} days late
            - else
              on time
          %td
            = check_box :name => "loans[#{loan.id}][disbursed?]"
          %td
            = select :name => "loans[#{loan.id}][disbursed_by_staff_id]", :collection => StaffMember.all.map{|s| [s.id.to_s,s.name]}, :selected => loan.client.center.manager.id.to_s
      %tfoot
        %tr
          %td{:colspan => 10}
    = submit 'Disburse these loans'
- else
  No disbursals today
